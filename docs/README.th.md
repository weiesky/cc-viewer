# CC-Viewer

ระบบตรวจสอบคำขอของ Claude Code ที่จับและแสดงผลคำขอและการตอบกลับ API ทั้งหมดของ Claude Code แบบเรียลไทม์ (ข้อความดิบ ไม่ถูกตัดทอน) สะดวกสำหรับนักพัฒนาในการตรวจสอบ Context ของตนเอง เพื่อทบทวนและแก้ไขปัญหาระหว่าง Vibe Coding

[English](../README.md) | [简体中文](./README.zh.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | [Русский](./README.ru.md) | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | ไทย | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## วิธีใช้งาน

### การติดตั้ง

```bash
npm install -g cc-viewer
```

### การรันและการกำหนดค่าอัตโนมัติ

```bash
ccv
```

คำสั่งนี้จะตรวจจับวิธีการติดตั้ง Claude Code ในเครื่องโดยอัตโนมัติ (NPM หรือ Native Install) และปรับเปลี่ยนให้เหมาะสม

- **การติดตั้งผ่าน NPM**: แทรกสคริปต์ดักจับลงใน `cli.js` ของ Claude Code โดยอัตโนมัติ
- **Native Install**: ตรวจจับไบนารี `claude` โดยอัตโนมัติ กำหนดค่าพร็อกซีโปร่งใสในเครื่อง และตั้งค่า Zsh Shell Hook เพื่อส่งต่อการรับส่งข้อมูลโดยอัตโนมัติ

### การแทนที่การกำหนดค่า (Configuration Override)

หากคุณต้องการใช้ API endpoint ที่กำหนดเอง (เช่น พร็อกซีองค์กร) เพียงกำหนดค่าใน `~/.claude/settings.json` หรือตั้งค่าตัวแปรสภาพแวดล้อม `ANTHROPIC_BASE_URL` `ccv` จะรับรู้โดยอัตโนมัติและส่งต่อคำขออย่างถูกต้อง

### โหมดเงียบ (Silent Mode)

ตามค่าเริ่มต้น `ccv` จะทำงานในโหมดเงียบเมื่อ wrap `claude` เพื่อให้แน่ใจว่าเอาต์พุตเทอร์มินัลของคุณยังคงสะอาดและสอดคล้องกับประสบการณ์ดั้งเดิม บันทึกทั้งหมดจะถูกจับในเบื้องหลังและสามารถดูได้ที่ `http://localhost:7008`

หลังจากการกำหนดค่าเสร็จสิ้น ให้ใช้คำสั่ง `claude` ตามปกติ ไปที่ `http://localhost:7008` เพื่อดูอินเทอร์เฟซการตรวจสอบ

### การแก้ไขปัญหา (Troubleshooting)

หากคุณพบปัญหาที่ไม่สามารถเริ่มต้นได้ มีวิธีแก้ไขปัญหาขั้นสุดท้าย:
ขั้นตอนที่ 1: เปิด Claude Code ในไดเรกทอรีใดก็ได้
ขั้นตอนที่ 2: ให้คำสั่งแก่ Claude Code ดังนี้:
```
ฉันได้ติดตั้งแพ็กเกจ npm ชื่อ cc-viewer แล้ว แต่หลังจากรัน ccv แล้วยังไม่สามารถทำงานได้อย่างถูกต้อง ให้ตรวจสอบ cli.js และ findcc.js ของ cc-viewer แล้วปรับให้เข้ากับวิธีการติดตั้ง Claude Code ในเครื่องตามสภาพแวดล้อมที่เฉพาะเจาะจง โดยพยายามจำกัดขอบเขตการแก้ไขไว้ที่ findcc.js เท่าที่เป็นไปได้
```
การให้ Claude Code ตรวจสอบข้อผิดพลาดด้วยตัวเองนั้นมีประสิทธิภาพมากกว่าการถามใครหรืออ่านเอกสารใดๆ!

หลังจากคำสั่งข้างต้นเสร็จสิ้น จะมีการอัปเดต findcc.js หากโปรเจกต์ของคุณต้องการการติดตั้งในเครื่องบ่อยครั้ง หรือโค้ดที่ fork ออกไปต้องแก้ปัญหาการติดตั้งบ่อยๆ ให้เก็บไฟล์นี้ไว้ ครั้งต่อไปสามารถ copy ไฟล์ได้โดยตรง ในปัจจุบันหลายโปรเจกต์และบริษัทที่ใช้ Claude Code ไม่ได้ติดตั้งบน Mac แต่เป็นการ deploy บนเซิร์ฟเวอร์ ดังนั้นผู้เขียนจึงแยก findcc.js ออกมาเพื่อให้ติดตามการอัปเดตซอร์สโค้ดของ cc-viewer ได้ง่ายขึ้นในอนาคต

### ถอนการติดตั้ง

```bash
ccv --uninstall
```

### ตรวจสอบเวอร์ชัน

```bash
ccv --version
```

## คุณสมบัติ

### การตรวจสอบคำขอ (โหมดข้อความดิบ)
<img width="1500" height="720" alt="image" src="https://github.com/user-attachments/assets/519dd496-68bd-4e76-84d7-2a3d14ae3f61" />
- จับคำขอ API ทั้งหมดจาก Claude Code แบบเรียลไทม์ รับรองว่าเป็นข้อความดิบ ไม่ใช่บันทึกที่ถูกตัดทอน (นี่สำคัญมาก!!!)
- ระบุและติดป้ายกำกับคำขอ Main Agent และ Sub Agent โดยอัตโนมัติ (ประเภทย่อย: Bash, Task, Plan, General)
- คำขอ MainAgent รองรับ Body Diff JSON แสดงความแตกต่างแบบพับได้กับคำขอ MainAgent ก่อนหน้า (แสดงเฉพาะฟิลด์ที่เปลี่ยนแปลง/เพิ่มเติม)
- แต่ละคำขอแสดงสถิติการใช้ Token แบบ inline (Token อินพุต/เอาต์พุต การสร้าง/อ่าน cache อัตราการเข้าถึง)
- รองรับ Claude Code Router (CCR) และสถานการณ์พร็อกซีอื่นๆ — จับคู่คำขอผ่านรูปแบบเส้นทาง API เป็นทางเลือกสำรอง

### โหมดสนทนา

คลิกปุ่ม "โหมดสนทนา" ที่มุมขวาบนเพื่อแยกวิเคราะห์ประวัติการสนทนาทั้งหมดของ Main Agent เป็นหน้าจอแชท:
<img width="1500" height="730" alt="image" src="https://github.com/user-attachments/assets/c973f142-748b-403f-b2b7-31a5d81e33e6" />


- ยังไม่รองรับการแสดงผล Agent Team
- ข้อความผู้ใช้จัดชิดขวา (ฟองสีน้ำเงิน) การตอบกลับของ Main Agent จัดชิดซ้าย (ฟองสีเข้ม)
- บล็อก `thinking` ถูกพับเป็นค่าเริ่มต้น แสดงผลเป็น Markdown คลิกเพื่อขยายดูกระบวนการคิด; รองรับการแปลด้วยคลิกเดียว (ฟีเจอร์ยังไม่เสถียร)
- ข้อความเลือกของผู้ใช้ (AskUserQuestion) แสดงในรูปแบบถาม-ตอบ
- การซิงค์โหมดสองทาง: เมื่อสลับไปโหมดสนทนาจะนำทางไปยังบทสนทนาที่ตรงกับคำขอที่เลือกโดยอัตโนมัติ; เมื่อสลับกลับไปโหมดข้อความดิบจะนำทางไปยังคำขอที่เลือกโดยอัตโนมัติ
- แผงการตั้งค่า: สามารถสลับสถานะการพับเริ่มต้นของผลลัพธ์เครื่องมือและบล็อก thinking


### เครื่องมือสถิติ

แผงลอย "สถิติข้อมูล" ในพื้นที่ส่วนหัว:
<img width="1500" height="729" alt="image" src="https://github.com/user-attachments/assets/b23f9a81-fc3d-4937-9700-e70d84e4e5ce" />

- แสดงจำนวน cache creation/read และอัตราการเข้าถึง cache
- สถิติการสร้าง cache ใหม่: แสดงจำนวนครั้งและ cache_creation tokens จัดกลุ่มตามสาเหตุ (TTL, system/tools/model เปลี่ยน, ข้อความถูกตัด/แก้ไข, key เปลี่ยน)
- สถิติการใช้เครื่องมือ: แสดงความถี่การใช้งานของแต่ละเครื่องมือเรียงตามจำนวนการเรียกใช้
- สถิติการใช้ Skill: แสดงความถี่การใช้งานของแต่ละ Skill เรียงตามจำนวนการเรียกใช้
- ไอคอนช่วยเหลือแนวคิด (?): คลิกเพื่อดูเอกสารในตัวของ MainAgent, CacheRebuild และเครื่องมือต่างๆ

### การจัดการ Log

ผ่านเมนูดรอปดาวน์ CC-Viewer ที่มุมซ้ายบน:
<img width="1200" height="672" alt="image" src="https://github.com/user-attachments/assets/8cf24f5b-9450-4790-b781-0cd074cd3b39" />

- นำเข้า log ในเครื่อง: เรียกดูไฟล์ log ย้อนหลัง จัดกลุ่มตามโปรเจกต์ เปิดในหน้าต่างใหม่
- โหลดไฟล์ JSONL ในเครื่อง: เลือกไฟล์ `.jsonl` ในเครื่องโดยตรงเพื่อดู (รองรับสูงสุด 500MB)
- บันทึก log ปัจจุบันเป็น: ดาวน์โหลดไฟล์ log JSONL ที่กำลังตรวจสอบอยู่
- รวม log: รวมไฟล์ log JSONL หลายไฟล์เป็นเซสชันเดียวเพื่อการวิเคราะห์แบบรวม
- ดู Prompt ผู้ใช้: ดึงและแสดงข้อมูลนำเข้าของผู้ใช้ทั้งหมด รองรับสามโหมดการดู — โหมดต้นฉบับ (เนื้อหาดิบ), โหมดบริบท (แท็กระบบยุบได้), โหมดข้อความ (ข้อความธรรมดา); คำสั่ง slash (`/model`, `/context` ฯลฯ) แสดงเป็นรายการอิสระ; แท็กที่เกี่ยวข้องกับคำสั่งจะถูกซ่อนอัตโนมัติจากเนื้อหา Prompt
- ส่งออก Prompt เป็น TXT: ส่งออก Prompt ผู้ใช้ (ข้อความธรรมดา ไม่รวมแท็กระบบ) เป็นไฟล์ `.txt` ในเครื่อง

### รองรับหลายภาษา

CC-Viewer รองรับ 18 ภาษา สลับอัตโนมัติตามภาษาของระบบ:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

## License

MIT
