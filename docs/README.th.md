# CC-Viewer

ระบบตรวจสอบคำขอสำหรับ Claude Code ที่จับและแสดงผลคำขอและการตอบกลับ API ทั้งหมดแบบเรียลไทม์ ช่วยให้นักพัฒนาตรวจสอบ Context เพื่อทบทวนและแก้ไขข้อผิดพลาดระหว่าง Vibe Coding

[简体中文](./README.zh.md) | [English](../README.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | [Русский](./README.ru.md) | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## การใช้งาน

### การติดตั้ง

```bash
npm install -g cc-viewer
```

### การรันและการกำหนดค่าอัตโนมัติ

```bash
ccv
```

คำสั่งนี้จะตรวจจับวิธีการติดตั้ง Claude Code ในเครื่องของคุณโดยอัตโนมัติ (NPM หรือ Native Install) และปรับเปลี่ยนให้เหมาะสม

- **NPM Install**: แทรกสคริปต์ดักจับลงใน `cli.js` ของ Claude Code โดยอัตโนมัติ
- **Native Install**: ตรวจจับไบนารี `claude` โดยอัตโนมัติ, กำหนดค่าพร็อกซีโปร่งใสในเครื่อง, และตั้งค่า Zsh Shell Hook เพื่อส่งต่อการรับส่งข้อมูลโดยอัตโนมัติ

### การแทนที่การกำหนดค่า (Configuration Override)

หากคุณต้องการใช้ API endpoint ที่กำหนดเอง (เช่น พร็อกซีองค์กร) เพียงกำหนดค่าใน `~/.claude/settings.json` หรือตั้งค่าตัวแปรสภาพแวดล้อม `ANTHROPIC_BASE_URL` `ccv` จะรับรู้สิ่งนี้โดยอัตโนมัติและส่งต่อคำขออย่างถูกต้อง

### โหมดเงียบ (Silent Mode)

ตามค่าเริ่มต้น `ccv` จะทำงานในโหมดเงียบเมื่อ wrap `claude` เพื่อให้แน่ใจว่าเอาต์พุตเทอร์มินัลของคุณยังคงสะอาดและเหมือนกับประสบการณ์ Claude Code เดิม บันทึกทั้งหมดจะถูกจับในเบื้องหลังและสามารถดูได้ที่ `http://localhost:7008`

หลังจากการกำหนดค่า ให้ใช้คำสั่ง `claude` ตามปกติ ไปที่ `http://localhost:7008` เพื่อดูอินเทอร์เฟซการตรวจสอบ

### การแก้ไขปัญหา (Troubleshooting)

- **เอาต์พุตผสม (Mixed Output)**: หากคุณเห็นบันทึกการดีบัก `[CC-Viewer]` ปะปนกับเอาต์พุตของ Claude โปรดอัปเดตเป็นเวอร์ชันล่าสุด (`npm install -g cc-viewer`)
- **การเชื่อมต่อถูกปฏิเสธ (Connection Refused)**: ตรวจสอบให้แน่ใจว่ากระบวนการเบื้องหลัง `ccv` กำลังทำงานอยู่ การรัน `ccv` หรือ `claude` (หลังจากติดตั้ง hook) ควรจะเริ่มต้นโดยอัตโนมัติ
- **ไม่มีเนื้อหา (Empty Body)**: หากคุณเห็น "No Body" ใน Viewer อาจเกิดจากรูปแบบ SSE ที่ไม่ได้มาตรฐาน ขณะนี้ Viewer รองรับการจับเนื้อหาดิบเป็นทางเลือกสำรอง

### ตรวจสอบเวอร์ชัน (Check Version)

```bash
ccv --version
```

### ถอนการติดตั้ง

```bash
ccv --uninstall
```

## คุณสมบัติ

### การตรวจสอบคำขอ (โหมด Raw)

- จับคำขอ API ทั้งหมดจาก Claude Code แบบเรียลไทม์ รวมถึงการตอบกลับแบบ streaming
- แผงด้านซ้ายแสดงเมธอดของคำขอ, URL, ระยะเวลา และรหัสสถานะ
- ระบุและติดป้ายกำกับคำขอ Main Agent และ Sub Agent โดยอัตโนมัติ (ประเภทย่อย: Bash, Task, Plan, General)
- รายการคำขอเลื่อนอัตโนมัติไปยังรายการที่เลือก (จัดกึ่งกลางเมื่อสลับโหมด, ใกล้ที่สุดเมื่อคลิกด้วยตนเอง)
- แผงด้านขวารองรับการสลับแท็บ Request / Response
- Request Body ขยาย `messages`, `system`, `tools` หนึ่งระดับตามค่าเริ่มต้น
- Response Body ขยายทั้งหมดตามค่าเริ่มต้น
- สลับระหว่างมุมมอง JSON และมุมมองข้อความธรรมดา
- คัดลอกเนื้อหา JSON ด้วยคลิกเดียว
- คำขอ MainAgent รองรับ Body Diff JSON แสดงความแตกต่างแบบพับได้กับคำขอ MainAgent ก่อนหน้า (แสดงเฉพาะฟิลด์ที่เปลี่ยนแปลง/เพิ่มเติม)
- ส่วน Diff รองรับการสลับมุมมอง JSON/Text และคัดลอกด้วยคลิกเดียว
- ตั้งค่า "Expand Diff": เมื่อเปิดใช้งาน คำขอ MainAgent จะขยายส่วน Diff โดยอัตโนมัติ
- Tooltip ของ Body Diff JSON สามารถปิดได้ เมื่อปิดแล้วการตั้งค่าจะถูกบันทึกบนเซิร์ฟเวอร์และจะไม่แสดงอีก
- Header ที่มีข้อมูลสำคัญ (`x-api-key`, `authorization`) จะถูกซ่อนอัตโนมัติในไฟล์ log JSONL เพื่อป้องกันการรั่วไหลของข้อมูลรับรอง
- สถิติการใช้ Token แบบ inline ต่อคำขอ (Token อินพุต/เอาต์พุต, การสร้าง/อ่าน cache, อัตราการเข้าถึง)
- รองรับ Claude Code Router (CCR) และการตั้งค่าพร็อกซีอื่นๆ — จับคู่คำขอผ่านรูปแบบเส้นทาง API เป็นทางเลือกสำรอง

### โหมด Chat

คลิกปุ่ม "โหมด Chat" ที่มุมขวาบนเพื่อแยกวิเคราะห์ประวัติการสนทนาทั้งหมดของ Main Agent เป็นหน้าจอแชท:

- ข้อความผู้ใช้จัดชิดขวา (ฟองสีน้ำเงิน) การตอบกลับของ Main Agent จัดชิดซ้าย (ฟองสีเข้ม) พร้อมการแสดงผล Markdown
- ข้อความ `/compact` ตรวจจับอัตโนมัติและแสดงแบบยุบ คลิกเพื่อขยายดูสรุปทั้งหมด
- ผลลัพธ์การเรียกเครื่องมือแสดงแบบ inline ภายในข้อความ Assistant ที่เกี่ยวข้อง
- บล็อก `thinking` ยุบตามค่าเริ่มต้น แสดงผลเป็น Markdown คลิกเพื่อขยาย; รองรับการแปลด้วยคลิกเดียว
- `tool_use` แสดงเป็นการ์ดเรียกเครื่องมือแบบกะทัดรัด (Bash, Read, Edit, Write, Glob, Grep, Task แต่ละตัวมีการแสดงผลเฉพาะ)
- ผลลัพธ์เครื่องมือ Task (SubAgent) แสดงผลเป็น Markdown
- ข้อความเลือกของผู้ใช้ (AskUserQuestion) แสดงในรูปแบบถาม-ตอบ
- แท็กระบบ (`<system-reminder>`, `<project-reminder>` ฯลฯ) ยุบอัตโนมัติ
- ข้อความการโหลด Skill ตรวจจับอัตโนมัติและยุบแสดงชื่อ Skill คลิกเพื่อขยายดูเอกสารฉบับเต็ม (แสดงผล Markdown)
- Skills reminder ตรวจจับอัตโนมัติและยุบ
- ข้อความระบบถูกกรองอัตโนมัติ แสดงเฉพาะข้อมูลที่ผู้ใช้ป้อนจริง
- แสดงแบบแบ่งหลาย session (แบ่งอัตโนมัติหลัง `/compact`, `/clear` ฯลฯ)
- แต่ละข้อความแสดง timestamp ที่แม่นยำถึงวินาที อ้างอิงจากเวลาของคำขอ API
- แต่ละข้อความมีลิงก์ "ดูคำขอ" เพื่อกลับไปยังโหมด raw ที่คำขอ API ที่เกี่ยวข้อง
- การซิงค์โหมดแบบสองทิศทาง: เมื่อสลับไปโหมดแชทจะเลื่อนไปยังบทสนทนาที่ตรงกับคำขอที่เลือก; เมื่อสลับกลับจะเลื่อนไปยังคำขอที่เลือก
- แผงตั้งค่า: สลับสถานะยุบเริ่มต้นสำหรับผลลัพธ์เครื่องมือและบล็อกการคิด
- ตั้งค่าทั่วไป: สลับการกรองคำขอที่ไม่เกี่ยวข้อง (count_tokens, heartbeat)

### การแปล

- บล็อก thinking และข้อความ Assistant รองรับการแปลด้วยคลิกเดียว
- ใช้ Claude Haiku API รองรับการยืนยันตัวตนทั้ง API Key (`x-api-key`) และ OAuth Bearer Token
- ผลการแปลจะถูกแคชอัตโนมัติ คลิกอีกครั้งเพื่อสลับกลับไปยังข้อความต้นฉบับ
- แสดงแอนิเมชันหมุนโหลดระหว่างการแปล

### สถิติ Token

แผงลอยในพื้นที่ส่วนหัว:

- จำนวน Token จัดกลุ่มตามโมเดล (input/output)
- จำนวน Cache creation/read และอัตราการเข้าถึง cache
- สถิติการสร้าง cache ใหม่จัดกลุ่มตามสาเหตุ (TTL, system/tools/model เปลี่ยน, ข้อความถูกตัด/แก้ไข, key เปลี่ยน) แสดงจำนวนครั้งและ cache_creation tokens
- สถิติการใช้เครื่องมือ: จำนวนการเรียกใช้ต่อเครื่องมือ เรียงตามความถี่
- สถิติการใช้ Skill: ความถี่การเรียกใช้ต่อ Skill เรียงตามความถี่
- ไอคอนช่วยเหลือแนวคิด (?): คลิกเพื่อดูเอกสารในตัวของ MainAgent, CacheRebuild และเครื่องมือแต่ละตัว
- นับถอยหลังการหมดอายุ cache ของ Main Agent

### การจัดการ Log

ผ่านเมนูดรอปดาวน์ CC-Viewer ที่มุมซ้ายบน:

- นำเข้า log ในเครื่อง: เรียกดูไฟล์ log ย้อนหลัง จัดกลุ่มตามโปรเจกต์ เปิดในหน้าต่างใหม่
- โหลดไฟล์ JSONL ในเครื่อง: เลือกและโหลดไฟล์ `.jsonl` ในเครื่องโดยตรง (สูงสุด 500MB)
- ดาวน์โหลด log ปัจจุบัน: ดาวน์โหลดไฟล์ log JSONL ที่กำลังตรวจสอบอยู่
- รวมล็อก: รวมไฟล์ล็อก JSONL หลายไฟล์เป็นเซสชันเดียวเพื่อการวิเคราะห์แบบรวม
- ดู Prompt ผู้ใช้: ดึงและแสดงข้อมูลนำเข้าของผู้ใช้ทั้งหมดด้วยสามโหมดการดู — โหมดต้นฉบับ (เนื้อหาดิบ), โหมดบริบท (แท็กระบบยุบได้), โหมดข้อความ (ข้อความธรรมชาติเท่านั้น); คำสั่ง slash (`/model`, `/context` ฯลฯ) แสดงเป็นรายการอิสระ; แท็กที่เกี่ยวข้องกับคำสั่งจะถูกซ่อนอัตโนมัติจากเนื้อหา Prompt
- ส่งออก prompt เป็น TXT: ส่งออก prompt ผู้ใช้ (ข้อความเท่านั้น ไม่รวมแท็กระบบ) เป็นไฟล์ `.txt` ในเครื่อง

### รองรับหลายภาษา

CC-Viewer รองรับ 18 ภาษา สลับอัตโนมัติตามภาษาของระบบ:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

## License

MIT
