# CC-Viewer

Система моніторингу запитів для Claude Code, яка захоплює та візуалізує всі API-запити та відповіді в реальному часі. Допомагає розробникам відстежувати Context для перегляду та налагодження під час Vibe Coding.

[简体中文](./README.zh.md) | [English](../README.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | [Русский](./README.ru.md) | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [ไทย](./README.th.md) | [Türkçe](./README.tr.md)

## Використання

### Встановлення

```bash
npm install -g cc-viewer
```

### Запуск та автоматичне налаштування

```bash
ccv
```

Ця команда автоматично визначає метод встановлення локального Claude Code (NPM або Native Install) та адаптується відповідним чином.

- **NPM Install**: Автоматично впроваджує скрипти перехоплення в `cli.js` Claude Code.
- **Native Install**: Автоматично виявляє бінарний файл `claude`, налаштовує локальний прозорий проксі та встановлює Zsh Shell Hook для автоматичної пересилки трафіку.

### Перевизначення конфігурації (Configuration Override)

Якщо вам потрібно використовувати користувацьку кінцеву точку API (наприклад, корпоративний проксі), просто налаштуйте її в `~/.claude/settings.json` або встановіть змінну оточення `ANTHROPIC_BASE_URL`. `ccv` автоматично розпізнає це та коректно перешле запити.

### Тихий режим (Silent Mode)

За замовчуванням `ccv` працює в тихому режимі при запуску `claude`, забезпечуючи чистоту виводу терміналу, ідентичну оригінальному досвіду Claude Code. Всі логи захоплюються у фоновому режимі та доступні для перегляду на `http://localhost:7008`.

Після налаштування використовуйте команду `claude` як зазвичай. Відвідайте `http://localhost:7008` для перегляду інтерфейсу моніторингу.

### Вирішення проблем (Troubleshooting)

- **Змішаний вивід (Mixed Output)**: Якщо ви бачите налагоджувальні логи `[CC-Viewer]` упереміш з виводом Claude, будь ласка, оновіться до останньої версії (`npm install -g cc-viewer`).
- **З'єднання відхилено (Connection Refused)**: Переконайтеся, що фоновий процес `ccv` запущений. Запуск `ccv` або `claude` (після встановлення хука) повинен запустити його автоматично.
- **Порожнє тіло (Empty Body)**: Якщо ви бачите "No Body" в Viewer, це може бути пов'язано з нестандартними форматами SSE. Viewer тепер підтримує захоплення сирого контенту як резервний варіант.

### Перевірка версії (Check Version)

```bash
ccv --version
```

### Видалення

```bash
ccv --uninstall
```

## Можливості

### Моніторинг запитів (режим Raw)

- Захоплення всіх API-запитів від Claude Code в реальному часі, включаючи потокові відповіді
- Ліва панель показує метод запиту, URL, тривалість та код статусу
- Автоматично ідентифікує та позначає запити Main Agent та Sub Agent (підтипи: Bash, Task, Plan, General)
- Список запитів автоматично прокручується до вибраного елемента (по центру при перемиканні режиму, до найближчого при ручному кліку)
- Права панель підтримує перемикання вкладок Request / Response
- Request Body розгортає `messages`, `system`, `tools` на один рівень за замовчуванням
- Response Body повністю розгорнутий за замовчуванням
- Перемикання між переглядом JSON та переглядом простого тексту
- Копіювання вмісту JSON одним кліком
- Запити MainAgent підтримують Body Diff JSON, відображаючи у згорнутому вигляді відмінності від попереднього запиту MainAgent (лише змінені/додані поля)
- Секція Diff підтримує перемикання між переглядом JSON/Text та копіювання одним кліком
- Налаштування «Розгорнути Diff»: при увімкненні запити MainAgent автоматично розгортають секцію diff
- Підказка Body Diff JSON може бути закрита; після закриття налаштування зберігається на сервері і більше не відображається
- Чутливі заголовки (`x-api-key`, `authorization`) автоматично маскуються у файлах логів JSONL для запобігання витоку облікових даних
- Вбудована статистика використання Token по кожному запиту (вхідні/вихідні токени, створення/читання кешу, відсоток влучень)
- Сумісність з Claude Code Router (CCR) та іншими проксі-конфігураціями — запити визначаються за шаблоном шляху API як резервний метод

### Режим Chat

Натисніть кнопку "Режим Chat" у верхньому правому куті, щоб розібрати повну історію розмов Main Agent у інтерфейс чату:

- Повідомлення користувача вирівняні праворуч (сині бульбашки), відповіді Main Agent вирівняні ліворуч (темні бульбашки) з рендерингом Markdown
- Повідомлення `/compact` автоматично виявляються та відображаються згорнутими, натисніть для розгортання повного резюме
- Результати виклику інструментів відображаються inline у відповідному повідомленні Assistant
- Блоки `thinking` згорнуті за замовчуванням, відображаються у форматі Markdown, натисніть для розгортання; підтримка перекладу одним натисканням
- `tool_use` відображається як компактні картки виклику інструментів (Bash, Read, Edit, Write, Glob, Grep, Task мають окреме відображення)
- Результати інструментів Task (SubAgent) відображаються у форматі Markdown
- Повідомлення вибору користувача (AskUserQuestion) відображаються у форматі запитань та відповідей
- Теги системні (`<system-reminder>`, `<project-reminder>` тощо) автоматично згорнуті
- Повідомлення про завантаження Skill автоматично виявляються та згортаються, відображаючи назву Skill; натисніть для розгортання повної документації (рендеринг Markdown)
- Skills reminder автоматично виявляються та згортаються
- Текст системний автоматично фільтрується, показуючи лише реальне введення користувача
- Сегментоване відображення кількох session (автоматична сегментація після `/compact`, `/clear` тощо)
- Кожне повідомлення показує мітку часу з точністю до секунди, розраховану на основі часу API-запиту
- Кожне повідомлення містить посилання «Переглянути запит» для переходу в режим raw до відповідного API-запиту
- Двонаправлена синхронізація режимів: при перемиканні в режим чату прокручується до розмови, що відповідає вибраному запиту; при перемиканні назад прокручується до вибраного запиту
- Панель налаштувань: перемикання стану згортання за замовчуванням для результатів інструментів та блоків роздумів
- Глобальні налаштування: перемикання фільтрації нерелевантних запитів (count_tokens, heartbeat)

### Переклад

- Блоки thinking та повідомлення Assistant підтримують переклад в один клік
- На основі Claude Haiku API, використовується лише автентифікація `x-api-key` (токени сесії OAuth виключені для запобігання забруднення контексту)
- Автоматично захоплює назву моделі haiku із запитів mainAgent; за замовчуванням `claude-haiku-4-5-20251001`
- Результати перекладу автоматично кешуються; натисніть знову для перемикання на оригінальний текст
- Анімація завантаження під час перекладу
- Іконка (?) поруч із заголовком `authorization` у деталях запиту веде до концептуального документа про забруднення контексту

### Статистика Token

Панель при наведенні в області заголовка:

- Кількість Token, згрупована за моделлю (input/output)
- Кількість Cache creation/read та відсоток влучень cache
- Статистика перебудови cache, згрупована за причиною (TTL, зміна system/tools/model, скорочення/модифікація повідомлень, зміна ключа) з кількістю та токенами cache_creation
- Статистика використання інструментів: кількість викликів на інструмент, відсортована за частотою
- Статистика використання Skill: частота викликів по кожному Skill, відсортована за частотою
- Іконки концептуальної довідки (?): натисніть для перегляду вбудованої документації MainAgent, CacheRebuild та кожного інструменту
- Зворотний відлік закінчення терміну дії cache Main Agent

### Керування логами

Через випадаюче меню CC-Viewer у верхньому лівому куті:

- Імпорт локальних логів: перегляд файлів історичних логів, згрупованих за проєктом, відкривається в новому вікні
- Завантаження локального JSONL файлу: безпосередній вибір та завантаження локального файлу `.jsonl` (до 200МБ)
- Завантаження поточного логу: завантаження поточного файлу логу моніторингу JSONL
- Об'єднання логів: об'єднання кількох файлів логів JSONL в одну сесію для єдиного аналізу
- Перегляд Prompt користувача: витяг та відображення всіх введень користувача з трьома режимами перегляду — режим Оригінал (вихідний вміст), режим Контекст (системні теги згортаються), режим Текст (лише простий текст); слеш-команди (`/model`, `/context` тощо) відображаються як окремі записи; теги, пов'язані з командами, автоматично приховуються з вмісту Prompt
- Експорт промптів у TXT: експорт промптів користувача (лише текст, без системних тегів) у локальний файл `.txt`

### Багатомовна підтримка

CC-Viewer підтримує 18 мов, автоматично перемикаючись залежно від мови системи:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

## License

MIT
