# CC-Viewer

Система мониторинга запросов Claude Code — перехватывает и визуализирует все API-запросы и ответы Claude Code в реальном времени (полный оригинальный текст, без купюр). Помогает разработчикам отслеживать свой контекст, просматривать и отлаживать проблемы в процессе Vibe Coding.

[English](../README.md) | [简体中文](./README.zh.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | Русский | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [ไทย](./README.th.md) | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## Использование

### Установка

```bash
npm install -g cc-viewer
```

### Запуск и автоматическая настройка

```bash
ccv
```

Команда автоматически определяет способ установки Claude Code (NPM или Native Install) и адаптируется соответственно.

- **NPM-установка**: автоматически внедряет перехватывающий скрипт в `cli.js` Claude Code.
- **Native Install**: автоматически обнаруживает бинарный файл `claude`, настраивает локальный прозрачный прокси и устанавливает Zsh Shell Hook для автоматической переадресации трафика.

### Переопределение конфигурации (Configuration Override)

Если вам нужно использовать пользовательский API-эндпоинт (например, корпоративный прокси), просто настройте его в `~/.claude/settings.json` или задайте переменную окружения `ANTHROPIC_BASE_URL`. `ccv` автоматически распознает её и корректно перенаправит запросы.

### Тихий режим (Silent Mode)

По умолчанию `ccv` работает в тихом режиме при запуске `claude`, обеспечивая чистый вывод в терминале, идентичный нативному опыту. Все логи перехватываются в фоновом режиме и доступны по адресу `http://localhost:7008`.

После настройки используйте команду `claude` как обычно. Откройте `http://localhost:7008` для просмотра интерфейса мониторинга.

### Устранение неполадок (Troubleshooting)

Если у вас возникли проблемы с запуском, есть универсальное решение:
Шаг 1: откройте Claude Code в любой директории;
Шаг 2: дайте Claude Code следующую инструкцию:
```
Я установил npm-пакет cc-viewer, но после запуска ccv он по-прежнему не работает корректно. Посмотри cli.js и findcc.js в cc-viewer, и адаптируй их под локальный способ развёртывания Claude Code с учётом конкретного окружения. Старайся ограничить область изменений файлом findcc.js.
```
Позволить Claude Code самостоятельно найти ошибку — эффективнее, чем спрашивать кого-либо или читать документацию!

После выполнения этой инструкции будет обновлён файл findcc.js. Если ваш проект часто требует локального развёртывания или форкнутый код регулярно нуждается в решении проблем установки — просто сохраните этот файл и в следующий раз скопируйте его напрямую. На данный момент многие проекты и компании используют Claude Code не на Mac, а на серверном хостинге, поэтому автор вынес findcc.js в отдельный файл для удобного отслеживания обновлений исходного кода cc-viewer.

### Удаление

```bash
ccv --uninstall
```

### Проверка версии

```bash
ccv --version
```

## Возможности

### Мониторинг запросов (режим оригинального текста)
<img width="1500" height="720" alt="image" src="https://github.com/user-attachments/assets/519dd496-68bd-4e76-84d7-2a3d14ae3f61" />
- Перехватывает все API-запросы Claude Code в реальном времени — в оригинальном виде, без усечения логов (это важно!!!)
- Автоматически распознаёт и маркирует запросы Main Agent и Sub Agent (подтипы: Bash, Task, Plan, General)
- Запросы MainAgent поддерживают Body Diff JSON — свёрнутое отображение различий с предыдущим запросом MainAgent (показываются только изменённые/добавленные поля)
- Встроенная статистика использования токенов для каждого запроса (входящие/исходящие токены, создание/чтение кэша, процент попаданий)
- Совместимость с Claude Code Router (CCR) и другими прокси-сценариями — резервное сопоставление запросов по шаблону API-пути

### Режим диалога

Нажмите кнопку «Режим диалога» в правом верхнем углу, чтобы отобразить полную историю переписки Main Agent в виде чата:
<img width="1500" height="730" alt="image" src="https://github.com/user-attachments/assets/c973f142-748b-403f-b2b7-31a5d81e33e6" />


- Отображение Agent Team пока не поддерживается
- Сообщения пользователя выровнены по правому краю (синие пузыри), ответы Main Agent — по левому (тёмные пузыри)
- Блоки `thinking` свёрнуты по умолчанию, отображаются в Markdown; нажмите для просмотра процесса рассуждений; поддерживается перевод в один клик (функция пока нестабильна)
- Сообщения с выбором пользователя (AskUserQuestion) отображаются в формате вопрос-ответ
- Двунаправленная синхронизация режимов: при переключении в режим диалога автоматически переходит к выбранному запросу; при возврате в режим оригинала автоматически позиционируется на выбранном запросе
- Панель настроек: переключение состояния свёртывания результатов инструментов и блоков thinking по умолчанию


### Инструменты статистики

Всплывающая панель «Статистика данных» в области заголовка:
<img width="1500" height="729" alt="image" src="https://github.com/user-attachments/assets/b23f9a81-fc3d-4937-9700-e70d84e4e5ce" />

- Отображает количество операций создания/чтения кэша и процент попаданий
- Статистика перестройки кэша: количество случаев и токены cache_creation, сгруппированные по причинам (TTL, изменение system/tools/model, усечение/изменение сообщений, изменение ключа)
- Статистика использования инструментов: частота вызовов каждого инструмента, отсортированная по количеству вызовов
- Статистика использования Skill: частота вызовов каждого Skill, отсортированная по количеству вызовов
- Иконка справки (?): нажмите для просмотра встроенной документации по MainAgent, CacheRebuild и каждому инструменту

### Управление логами

Через выпадающее меню CC-Viewer в верхнем левом углу:
<img width="1200" height="672" alt="image" src="https://github.com/user-attachments/assets/8cf24f5b-9450-4790-b781-0cd074cd3b39" />

- Импорт локальных логов: просмотр исторических файлов логов, сгруппированных по проекту, открывается в новом окне
- Загрузить локальный JSONL-файл: выбор локального файла `.jsonl` для загрузки (поддерживается до 500 МБ)
- Сохранить текущий лог как: скачать текущий файл лога мониторинга JSONL
- Объединение логов: объединение нескольких файлов логов JSONL в одну сессию для единого анализа
- Просмотр Prompt пользователя: извлечение и отображение всех пользовательских вводов с тремя режимами просмотра — режим Оригинал (исходное содержимое), режим Контекст (системные теги сворачиваемые), режим Текст (только простой текст); слеш-команды (`/model`, `/context` и т.д.) отображаются как отдельные записи; теги, связанные с командами, автоматически скрываются из содержимого Prompt
- Экспорт Prompt в TXT: экспорт пользовательских Prompt (простой текст, без системных тегов) в локальный файл `.txt`

### Многоязычная поддержка

CC-Viewer поддерживает 18 языков, автоматически переключаясь на основе системной локали:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

### Автоматическое обновление

CC-Viewer автоматически проверяет обновления при запуске (не чаще одного раза в 4 часа). В пределах одной основной версии (например, 1.x.x → 1.y.z) обновления применяются автоматически и вступают в силу при следующем запуске. При смене основной версии отображается только уведомление.

Автоматическое обновление следует глобальной конфигурации Claude Code в `~/.claude/settings.json`. Если в Claude Code автоматические обновления отключены (`autoUpdates: false`), CC-Viewer также пропустит автоматическое обновление.

## License

MIT
