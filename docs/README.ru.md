# CC-Viewer

Система мониторинга запросов Claude Code, которая перехватывает и визуально отображает все API-запросы и ответы Claude Code в реальном времени (оригинальный текст, без обрезки). Удобна для разработчиков, чтобы отслеживать свой Context и просматривать и устранять проблемы в процессе Vibe Coding.

[English](../README.md) | [简体中文](./README.zh.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | Русский | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [ไทย](./README.th.md) | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## Использование

### Установка

```bash
npm install -g cc-viewer
```

### Запуск и автоматическая настройка

```bash
ccv
```

Эта команда автоматически определяет метод установки локального Claude Code (NPM или Native Install) и адаптируется соответствующим образом.

- **Установка через NPM**: Автоматически внедряет скрипт перехвата в `cli.js` Claude Code.
- **Native Install**: Автоматически обнаруживает бинарный файл `claude`, настраивает локальный прозрачный прокси и устанавливает Zsh Shell Hook для автоматической пересылки трафика.

### Переопределение конфигурации (Configuration Override)

Если вам нужно использовать пользовательскую конечную точку API (например, корпоративный прокси), просто настройте её в `~/.claude/settings.json` или установите переменную окружения `ANTHROPIC_BASE_URL`. `ccv` автоматически распознает это и корректно перешлёт запросы.

### Тихий режим (Silent Mode)

По умолчанию `ccv` работает в тихом режиме при оборачивании `claude`, обеспечивая чистоту вывода терминала, идентичную нативному опыту. Все логи захватываются в фоновом режиме и доступны для просмотра на `http://localhost:7008`.

После завершения настройки используйте команду `claude` как обычно. Посетите `http://localhost:7008` для просмотра интерфейса мониторинга.

### Устранение неполадок (Troubleshooting)

- **Смешанный вывод (Mixed Output)**: Если вы видите отладочные логи `[CC-Viewer]` вперемешку с выводом Claude, обновитесь до последней версии (`npm install -g cc-viewer`).
- **Соединение отклонено (Connection Refused)**: Убедитесь, что фоновый процесс `ccv` запущен. Запуск `ccv` или `claude` (после установки хука) должен запустить его автоматически.
- **Пустое тело (Empty Body)**: Если вы видите "No Body" в Viewer, это может быть связано с нестандартными форматами SSE. Viewer теперь поддерживает захват сырого контента в качестве резервного варианта.

### Удаление

```bash
ccv --uninstall
```

### Проверка версии

```bash
ccv --version
```

## Возможности

### Мониторинг запросов (режим оригинального текста)
<img width="1500" height="720" alt="image" src="https://github.com/user-attachments/assets/519dd496-68bd-4e76-84d7-2a3d14ae3f61" />
- Перехват в реальном времени всех API-запросов от Claude Code, гарантируя оригинальный текст, а не обрезанные логи (это важно!!!)
- Автоматически определяет и помечает запросы Main Agent и Sub Agent (подтипы: Bash, Task, Plan, General)
- Запросы MainAgent поддерживают Body Diff JSON, отображая в свёрнутом виде отличия от предыдущего запроса MainAgent (только изменённые/добавленные поля)
- Встроенная статистика использования Token по каждому запросу (входные/выходные токены, создание/чтение кэша, процент попаданий)
- Совместимость с Claude Code Router (CCR) и другими прокси-сценариями — запросы определяются по шаблону пути API в качестве резервного метода

### Режим диалога

Нажмите кнопку «Режим диалога» в правом верхнем углу, чтобы преобразовать полную историю диалога Main Agent в интерфейс чата:
<img width="1500" height="730" alt="image" src="https://github.com/user-attachments/assets/c973f142-748b-403f-b2b7-31a5d81e33e6" />


- Пока не поддерживается отображение Agent Team
- Сообщения пользователя выровнены вправо (синие пузыри), ответы Main Agent выровнены влево (тёмные пузыри)
- Блоки `thinking` по умолчанию свёрнуты, отрендерены в Markdown, нажмите для раскрытия и просмотра процесса мышления; поддерживается перевод в один клик (функция пока нестабильна)
- Сообщения выбора пользователя (AskUserQuestion) отображаются в формате вопрос-ответ
- Двусторонняя синхронизация режимов: переключение в режим диалога автоматически позиционирует на соответствующий диалог выбранного запроса; переключение обратно в режим оригинального текста автоматически позиционирует на выбранный запрос
- Панель настроек: переключение состояния свёрнутости по умолчанию для результатов инструментов и блоков мышления


### Инструменты статистики

Всплывающая панель «Статистика данных» в области заголовка:
<img width="1500" height="729" alt="image" src="https://github.com/user-attachments/assets/b23f9a81-fc3d-4937-9700-e70d84e4e5ce" />

- Отображает количество cache creation/read и процент попаданий в кэш
- Статистика пересоздания кэша: сгруппирована по причине (TTL, изменение system/tools/model, усечение/изменение сообщений, изменение ключа) с количеством и токенами cache_creation
- Статистика использования инструментов: отображает частоту вызовов каждого инструмента, отсортированную по количеству вызовов
- Статистика использования Skill: отображает частоту вызовов каждого Skill, отсортированную по количеству вызовов
- Иконка концептуальной справки (?): нажмите для просмотра встроенной документации MainAgent, CacheRebuild и различных инструментов

### Управление логами

Через выпадающее меню CC-Viewer в левом верхнем углу:
<img width="1200" height="672" alt="image" src="https://github.com/user-attachments/assets/8cf24f5b-9450-4790-b781-0cd074cd3b39" />

- Импорт локальных логов: просмотр исторических файлов логов, сгруппированных по проекту, открывается в новом окне
- Загрузить локальный JSONL файл: выбор локального файла `.jsonl` для загрузки (поддерживается до 500МБ)
- Сохранить текущий лог как: скачать текущий файл лога мониторинга JSONL
- Объединение логов: объединение нескольких файлов логов JSONL в одну сессию для единого анализа
- Просмотр Prompt пользователя: извлечение и отображение всех пользовательских вводов с тремя режимами просмотра — режим Оригинал (исходное содержимое), режим Контекст (системные теги сворачиваемые), режим Текст (только простой текст); слеш-команды (`/model`, `/context` и т.д.) отображаются как отдельные записи; теги, связанные с командами, автоматически скрываются из содержимого Prompt
- Экспорт Prompt в TXT: экспорт пользовательских Prompt (простой текст, без системных тегов) в локальный файл `.txt`

### Многоязычная поддержка

CC-Viewer поддерживает 18 языков, автоматически переключаясь на основе системной локали:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

## License

MIT
