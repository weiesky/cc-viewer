# CC-Viewer
[![npm version](https://img.shields.io/npm/v/cc-viewer)](https://www.npmjs.com/package/cc-viewer)

نظام مراقبة الطلبات لـ Claude Code يلتقط ويعرض جميع طلبات واستجابات API في الوقت الفعلي. يساعد المطورين على مراقبة Context الخاص بهم للمراجعة وتصحيح الأخطاء أثناء Vibe Coding.

[简体中文](./README.zh.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | [Русский](./README.ru.md) | [العربية](./README.ar.md) | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [ไทย](./README.th.md) | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## الاستخدام

### التثبيت

```bash
npm install -g cc-viewer
```

### التشغيل والتهيئة التلقائية

```bash
ccv
```

يكتشف هذا الأمر تلقائيًا طريقة تثبيت Claude Code المحلية (NPM أو Native Install) ويتكيف وفقًا لذلك.

- **NPM Install**: يقوم تلقائيًا بحقن نصوص الاعتراض في `cli.js` الخاص بـ Claude Code.
- **Native Install**: يكتشف تلقائيًا ملف `claude` الثنائي، ويهيئ وكيلًا محليًا شفافًا، ويقوم بإعداد Zsh Shell Hook لإعادة توجيه حركة المرور تلقائيًا.

### تجاوز التكوين (Configuration Override)

إذا كنت بحاجة إلى استخدام نقطة نهاية API مخصصة (مثل وكيل الشركة)، فما عليك سوى تكوينها في `~/.claude/settings.json` أو تعيين متغير البيئة `ANTHROPIC_BASE_URL`. سيتعرف `ccv` تلقائيًا على ذلك ويعيد توجيه الطلبات بشكل صحيح.

### الوضع الصامت (Silent Mode)

بشكل افتراضي، يعمل `ccv` في الوضع الصامت عند تغليف `claude`، مما يضمن بقاء مخرجات المحطة نظيفة ومطابقة لتجربة Claude Code الأصلية. يتم التقاط جميع السجلات في الخلفية ويمكن عرضها على `http://localhost:7008`.

بعد التكوين، استخدم الأمر `claude` كالمعتاد. قم بزيارة `http://localhost:7008` لعرض واجهة المراقبة.

### استكشاف الأخطاء وإصلاحها (Troubleshooting)

- **مخرجات مختلطة (Mixed Output)**: إذا رأيت سجلات تصحيح الأخطاء `[CC-Viewer]` مختلطة مع مخرجات Claude، يرجى التحديث إلى أحدث إصدار (`npm install -g cc-viewer`).
- **تم رفض الاتصال (Connection Refused)**: تأكد من تشغيل عملية الخلفية `ccv`. يجب أن يؤدي تشغيل `ccv` أو `claude` (بعد تثبيت الـ hook) إلى تشغيله تلقائيًا.
- **جسم فارغ (Empty Body)**: إذا رأيت "No Body" في العارض، فقد يكون ذلك بسبب تنسيقات SSE غير القياسية. يدعم العارض الآن التقاط المحتوى الخام كخيار احتياطي.

### التحقق من الإصدار (Check Version)

```bash
ccv --version
```

### إلغاء التثبيت

```bash
ccv --uninstall
```

## الميزات

### مراقبة الطلبات (Raw Mode)

- التقاط في الوقت الفعلي لجميع طلبات API من Claude Code، بما في ذلك الاستجابات المتدفقة
- اللوحة اليسرى تعرض طريقة الطلب، URL، المدة، ورمز الحالة
- تحديد وتصنيف تلقائي لطلبات Main Agent و Sub Agent (أنواع فرعية: Bash، Task، Plan، General)
- قائمة الطلبات تنتقل تلقائيًا إلى العنصر المحدد (توسيط عند تبديل الوضع، الأقرب عند النقر اليدوي)
- اللوحة اليمنى تدعم التبديل بين علامتي Request / Response
- Request Body يوسع `messages`، `system`، `tools` بمستوى واحد افتراضيًا
- Response Body موسع بالكامل افتراضيًا
- التبديل بين عرض JSON وعرض النص العادي
- نسخ محتوى JSON بنقرة واحدة
- طلبات MainAgent تدعم Body Diff JSON، تعرض بشكل مطوي الفروقات مع طلب MainAgent السابق (الحقول المتغيرة/المضافة فقط)
- قسم Diff يدعم التبديل بين عرض JSON وعرض النص مع نسخ بنقرة واحدة
- إعداد "توسيع Diff": عند التفعيل، طلبات MainAgent توسع قسم Diff تلقائيًا
- يمكن إغلاق تلميح Body Diff JSON؛ بعد الإغلاق يتم حفظ التفضيل على الخادم ولن يظهر مرة أخرى
- الرؤوس الحساسة (`x-api-key`، `authorization`) يتم إخفاؤها تلقائيًا في ملفات سجل JSONL لمنع تسرب بيانات الاعتماد
- إحصائيات استخدام Token مضمنة لكل طلب (Token الإدخال/الإخراج، إنشاء/قراءة Cache، نسبة الإصابة)
- متوافق مع Claude Code Router (CCR) وإعدادات الوكيل الأخرى — يتم مطابقة الطلبات عبر نمط مسار API كاحتياطي

### Chat Mode

انقر على زر "Chat mode" في أعلى اليمين لتحليل سجل المحادثة الكامل لـ Main Agent إلى واجهة دردشة:

- رسائل المستخدم محاذاة لليمين (فقاعات زرقاء)، ردود Main Agent محاذاة لليسار (فقاعات داكنة) مع عرض Markdown
- رسائل `/compact` يتم اكتشافها تلقائيًا وعرضها مطوية، انقر لتوسيع الملخص الكامل
- نتائج استدعاءات الأدوات معروضة ضمنيًا داخل رسالة Assistant المقابلة
- كتل `thinking` مطوية افتراضيًا، تُعرض بتنسيق Markdown، انقر للتوسيع؛ تدعم الترجمة بنقرة واحدة
- `tool_use` معروض كبطاقات استدعاء أدوات مدمجة (Bash، Read، Edit، Write، Glob، Grep، Task لكل منها عرض مخصص)
- نتائج أدوات Task (SubAgent) تُعرض بتنسيق Markdown
- رسائل اختيار المستخدم (AskUserQuestion) معروضة بتنسيق سؤال وجواب
- وسوم النظام (`<system-reminder>`، `<project-reminder>`، إلخ) مطوية تلقائيًا
- رسائل تحميل Skill يتم اكتشافها تلقائيًا وطيها، مع عرض اسم Skill؛ انقر للتوسيع وعرض الوثائق الكاملة (عرض Markdown)
- يتم اكتشاف Skills reminder تلقائيًا وطيها
- النص النظامي يُفلتر تلقائيًا، ويعرض فقط مدخلات المستخدم الحقيقية
- عرض مقسم إلى جلسات متعددة (تقسيم تلقائي بعد `/compact`، `/clear`، إلخ)
- كل رسالة تعرض طابعًا زمنيًا بدقة الثانية، مُستمد من توقيت طلب API
- كل رسالة تحتوي على رابط "عرض الطلب" للانتقال إلى الوضع الخام عند طلب API المقابل
- مزامنة ثنائية الاتجاه للأوضاع: التبديل إلى وضع الدردشة ينتقل إلى المحادثة المطابقة للطلب المحدد؛ التبديل للخلف ينتقل إلى الطلب المحدد
- لوحة الإعدادات: تبديل حالة الطي الافتراضية لنتائج الأدوات وكتل التفكير
- الإعدادات العامة: تبديل تصفية الطلبات غير ذات الصلة (count_tokens، heartbeat)

### الترجمة

- كتل thinking ورسائل Assistant تدعم الترجمة بنقرة واحدة
- مبني على Claude Haiku API، يستخدم مصادقة `x-api-key` فقط (يتم استبعاد رموز جلسة OAuth لمنع تلوث السياق)
- يلتقط تلقائياً اسم نموذج haiku من طلبات mainAgent؛ الافتراضي `claude-haiku-4-5-20251001`
- نتائج الترجمة تُخزَّن مؤقتاً تلقائياً؛ انقر مرة أخرى للعودة إلى النص الأصلي
- رسوم متحركة للتحميل أثناء الترجمة
- أيقونة (?) بجانب رأس `authorization` في تفاصيل الطلب تربط بوثيقة المفهوم حول تلوث السياق

### Token Stats

لوحة تظهر عند التمرير في منطقة الرأس:

- عدد Token مجمع حسب النموذج (إدخال/إخراج)
- عدد إنشاء/قراءة Cache ونسبة إصابة Cache
- إحصائيات إعادة بناء Cache مجمعة حسب السبب (TTL، تغيير system/tools/model، اقتطاع/تعديل الرسائل، تغيير المفتاح) مع عدد المرات وعدد cache_creation tokens
- إحصائيات استخدام الأدوات: عدد الاستدعاءات لكل أداة، مرتبة حسب التكرار
- إحصائيات استخدام Skill: تكرار الاستدعاء لكل Skill، مرتبة حسب التكرار
- أيقونات المساعدة المفاهيمية (?): انقر لعرض الوثائق المدمجة لـ MainAgent وCacheRebuild وكل أداة
- العد التنازلي لانتهاء صلاحية Cache لـ Main Agent

### إدارة السجلات

عبر القائمة المنسدلة CC-Viewer في أعلى اليسار:

- استيراد السجلات المحلية: تصفح ملفات السجلات التاريخية، مجمعة حسب المشروع، تفتح في نافذة جديدة
- تحميل ملف JSONL محلي: اختيار وتحميل ملف `.jsonl` محلي مباشرة (حتى 200 ميجابايت)
- تنزيل السجل الحالي: تنزيل ملف سجل المراقبة JSONL الحالي
- دمج السجلات: دمج عدة ملفات سجلات JSONL في جلسة واحدة للتحليل الموحد
- عرض Prompt المستخدم: استخراج وعرض جميع مدخلات المستخدم بثلاثة أوضاع عرض — وضع الأصل (المحتوى الخام)، وضع السياق (علامات النظام قابلة للطي)، وضع النص (نص عادي فقط)؛ أوامر الشرطة المائلة (`/model`، `/context`، إلخ) تُعرض كإدخالات مستقلة؛ العلامات المتعلقة بالأوامر تُخفى تلقائيًا من محتوى Prompt
- تصدير المطالبات إلى TXT: تصدير مطالبات المستخدم (نص فقط، بدون وسوم النظام) إلى ملف `.txt` محلي

### دعم متعدد اللغات

يدعم CC-Viewer 18 لغة، ويتبدل تلقائيًا بناءً على إعدادات النظام المحلية:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

## License

MIT
