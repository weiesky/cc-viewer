# CC-Viewer

نظام مراقبة طلبات Claude Code، يلتقط ويعرض بصريًا جميع طلبات واستجابات API الخاصة بـ Claude Code في الوقت الفعلي (نص أصلي، بدون اقتطاع). يسهّل على المطورين مراقبة Context الخاص بهم لمراجعة واستكشاف المشكلات أثناء Vibe Coding.

[English](../README.md) | [简体中文](./README.zh.md) | [繁體中文](./README.zh-TW.md) | [한국어](./README.ko.md) | [日本語](./README.ja.md) | [Deutsch](./README.de.md) | [Español](./README.es.md) | [Français](./README.fr.md) | [Italiano](./README.it.md) | [Dansk](./README.da.md) | [Polski](./README.pl.md) | [Русский](./README.ru.md) | العربية | [Norsk](./README.no.md) | [Português (Brasil)](./README.pt-BR.md) | [ไทย](./README.th.md) | [Türkçe](./README.tr.md) | [Українська](./README.uk.md)

## الاستخدام

### التثبيت

```bash
npm install -g cc-viewer
```

### التشغيل والتهيئة التلقائية

```bash
ccv
```

يكتشف هذا الأمر تلقائيًا طريقة تثبيت Claude Code المحلية (NPM أو Native Install) ويتكيف وفقًا لذلك.

- **تثبيت NPM**: يقوم تلقائيًا بحقن نص الاعتراض في `cli.js` الخاص بـ Claude Code.
- **Native Install**: يكتشف تلقائيًا ملف `claude` الثنائي، ويهيئ وكيلًا محليًا شفافًا، ويقوم بإعداد Zsh Shell Hook لإعادة توجيه حركة المرور تلقائيًا.

### تجاوز التكوين (Configuration Override)

إذا كنت بحاجة إلى استخدام نقطة نهاية API مخصصة (مثل وكيل الشركة)، فما عليك سوى تكوينها في `~/.claude/settings.json` أو تعيين متغير البيئة `ANTHROPIC_BASE_URL`. سيتعرف `ccv` تلقائيًا على ذلك ويعيد توجيه الطلبات بشكل صحيح.

### الوضع الصامت (Silent Mode)

بشكل افتراضي، يعمل `ccv` في الوضع الصامت عند تغليف `claude`، مما يضمن بقاء مخرجات المحطة الطرفية نظيفة ومتسقة مع التجربة الأصلية. يتم التقاط جميع السجلات في الخلفية ويمكن عرضها على `http://localhost:7008`.

بعد اكتمال التهيئة، استخدم الأمر `claude` كالمعتاد. قم بزيارة `http://localhost:7008` لعرض واجهة المراقبة.

### استكشاف الأخطاء وإصلاحها (Troubleshooting)

إذا واجهت مشكلة في عدم القدرة على التشغيل، فهناك حل نهائي لاستكشاف الأخطاء:
الخطوة الأولى: افتح Claude Code في أي مجلد؛
الخطوة الثانية: أعطِ Claude Code التعليمات التالية:
```
لقد قمت بتثبيت حزمة npm الخاصة بـ cc-viewer، لكن بعد تشغيل ccv لا تزال لا تعمل بشكل صحيح. راجع cli.js وfindcc.js الخاصين بـ cc-viewer، وقم بتكييف طريقة نشر Claude Code المحلية بناءً على البيئة المحددة. حاول تقييد نطاق التعديلات في findcc.js قدر الإمكان.
```
إن جعل Claude Code يفحص الأخطاء بنفسه هو وسيلة أكثر فعالية من سؤال أي شخص أو قراءة أي وثيقة!

بعد اكتمال التعليمات أعلاه، سيتم تحديث findcc.js. إذا كان مشروعك يحتاج في كثير من الأحيان إلى نشر محلي، أو إذا كان الكود المتفرع يحتاج إلى حل مشكلات التثبيت بشكل متكرر، فاحتفظ بهذا الملف ويمكنك نسخه مباشرة في المرة القادمة. في الوقت الحالي، كثير من المشاريع والشركات التي تستخدم Claude Code لا تنشره على Mac بل على خوادم مستضافة، لذا قام المؤلف بفصل ملف findcc.js لتسهيل تتبع تحديثات الكود المصدري لـ cc-viewer لاحقًا.

### إلغاء التثبيت

```bash
ccv --uninstall
```

### التحقق من الإصدار

```bash
ccv --version
```

## الميزات

### مراقبة الطلبات (وضع النص الأصلي)
<img width="1500" height="720" alt="image" src="https://github.com/user-attachments/assets/519dd496-68bd-4e76-84d7-2a3d14ae3f61" />
- التقاط جميع طلبات API من Claude Code في الوقت الفعلي، مع ضمان أنه النص الأصلي وليس سجلات مقتطعة (هذا مهم جدًا!!!)
- تحديد وتصنيف تلقائي لطلبات Main Agent و Sub Agent (أنواع فرعية: Bash، Task، Plan، General)
- طلبات MainAgent تدعم Body Diff JSON، تعرض بشكل مطوي الفروقات مع طلب MainAgent السابق (الحقول المتغيرة/المضافة فقط)
- إحصائيات استخدام Token مضمنة لكل طلب (Token الإدخال/الإخراج، إنشاء/قراءة Cache، نسبة الإصابة)
- متوافق مع Claude Code Router (CCR) وسيناريوهات الوكيل الأخرى — يتم مطابقة الطلبات عبر نمط مسار API كاحتياطي

### وضع المحادثة

انقر على زر "وضع المحادثة" في أعلى اليمين لتحليل سجل المحادثة الكامل لـ Main Agent إلى واجهة دردشة:
<img width="1500" height="730" alt="image" src="https://github.com/user-attachments/assets/c973f142-748b-403f-b2b7-31a5d81e33e6" />


- لا يدعم حاليًا عرض Agent Team
- رسائل المستخدم محاذاة لليمين (فقاعات زرقاء)، ردود Main Agent محاذاة لليسار (فقاعات داكنة)
- كتل `thinking` مطوية افتراضيًا، معروضة بتنسيق Markdown، انقر للتوسيع وعرض عملية التفكير؛ تدعم الترجمة بنقرة واحدة (الميزة لا تزال غير مستقرة)
- رسائل اختيار المستخدم (AskUserQuestion) تُعرض بتنسيق سؤال وجواب
- مزامنة ثنائية الاتجاه بين الأوضاع: التبديل إلى وضع المحادثة يحدد تلقائيًا المحادثة المقابلة للطلب المحدد؛ التبديل مرة أخرى إلى وضع النص الأصلي يحدد تلقائيًا الطلب المحدد
- لوحة الإعدادات: تبديل حالة الطي الافتراضية لنتائج الأدوات وكتل التفكير


### أدوات الإحصائيات

لوحة "إحصائيات البيانات" المنبثقة في منطقة الرأس:
<img width="1500" height="729" alt="image" src="https://github.com/user-attachments/assets/b23f9a81-fc3d-4937-9700-e70d84e4e5ce" />

- عرض عدد cache creation/read ونسبة إصابة Cache
- إحصائيات إعادة بناء Cache: مجمعة حسب السبب (TTL، تغيير system/tools/model، اقتطاع/تعديل الرسائل، تغيير المفتاح) مع عدد المرات وعدد cache_creation tokens
- إحصائيات استخدام الأدوات: عرض تكرار استدعاء كل أداة مرتبة حسب عدد الاستدعاءات
- إحصائيات استخدام Skill: عرض تكرار استدعاء كل Skill مرتبة حسب عدد الاستدعاءات
- أيقونة المساعدة المفاهيمية (?): انقر لعرض الوثائق المدمجة لـ MainAgent وCacheRebuild والأدوات المختلفة

### إدارة السجلات

عبر القائمة المنسدلة CC-Viewer في أعلى اليسار:
<img width="1200" height="672" alt="image" src="https://github.com/user-attachments/assets/8cf24f5b-9450-4790-b781-0cd074cd3b39" />

- استيراد السجلات المحلية: تصفح ملفات السجلات التاريخية، مجمعة حسب المشروع، تفتح في نافذة جديدة
- تحميل ملف JSONL محلي: اختيار ملف `.jsonl` محلي مباشرة للتحميل (يدعم حتى 500 ميجابايت)
- حفظ السجل الحالي باسم: تنزيل ملف سجل المراقبة JSONL الحالي
- دمج السجلات: دمج عدة ملفات سجلات JSONL في جلسة واحدة للتحليل الموحد
- عرض Prompt المستخدم: استخراج وعرض جميع مدخلات المستخدم بثلاثة أوضاع عرض — وضع الأصل (المحتوى الخام)، وضع السياق (وسوم النظام قابلة للطي)، وضع النص (نص عادي فقط)؛ أوامر الشرطة المائلة (`/model`، `/context`، إلخ) تُعرض كإدخالات مستقلة؛ الوسوم المتعلقة بالأوامر تُخفى تلقائيًا من محتوى Prompt
- تصدير Prompt إلى TXT: تصدير Prompt المستخدم (نص عادي، بدون وسوم النظام) إلى ملف `.txt` محلي

### دعم متعدد اللغات

يدعم CC-Viewer 18 لغة، ويتبدل تلقائيًا بناءً على إعدادات لغة النظام:

简体中文 | English | 繁體中文 | 한국어 | Deutsch | Español | Français | Italiano | Dansk | 日本語 | Polski | Русский | العربية | Norsk | Português (Brasil) | ไทย | Türkçe | Українська

### التحديث التلقائي

يتحقق CC-Viewer تلقائيًا من التحديثات عند بدء التشغيل (مرة واحدة كل 4 ساعات كحد أقصى). ضمن نفس الإصدار الرئيسي (مثل 1.x.x → 1.y.z)، يتم تطبيق التحديثات تلقائيًا وتسري عند إعادة التشغيل التالية. تغييرات الإصدار الرئيسي تعرض إشعارًا فقط.

يتبع التحديث التلقائي إعدادات Claude Code العامة في `~/.claude/settings.json`. إذا كان Claude Code قد عطّل التحديثات التلقائية (`autoUpdates: false`)، فسيتخطى CC-Viewer التحديث التلقائي أيضًا.

## License

MIT
