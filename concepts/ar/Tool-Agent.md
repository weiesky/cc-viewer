# Agent

## التعريف

بدء وكيل فرعي (SubAgent) لمعالجة المهام المعقدة متعددة الخطوات بشكل مستقل. الوكلاء الفرعيون هم عمليات فرعية مستقلة، لكل منها مجموعة أدوات وسياق مخصص. Agent هو النسخة المعاد تسميتها من أداة Task في الإصدارات الأحدث من Claude Code.

## المعاملات

| المعامل | النوع | مطلوب | الوصف |
|---------|-------|-------|-------|
| `prompt` | string | نعم | وصف المهمة التي سينفذها الوكيل الفرعي |
| `description` | string | نعم | ملخص مختصر من 3-5 كلمات |
| `subagent_type` | string | نعم | نوع الوكيل الفرعي، يحدد مجموعة الأدوات المتاحة |
| `model` | enum | لا | تحديد النموذج (sonnet / opus / haiku)، الافتراضي يرث من الأصل |
| `max_turns` | integer | لا | الحد الأقصى لعدد الجولات |
| `run_in_background` | boolean | لا | هل يعمل في الخلفية، المهام الخلفية تُرجع مسار output_file |
| `resume` | string | لا | معرف الوكيل المراد استئنافه، يستمر من آخر تنفيذ. مفيد لاستئناف وكيل فرعي سابق دون فقدان السياق |
| `isolation` | enum | لا | وضع العزل، `worktree` ينشئ git worktree مؤقت |

## أنواع الوكلاء الفرعيين

| النوع | الغرض | الأدوات المتاحة |
|-------|--------|----------------|
| `Bash` | تنفيذ الأوامر، عمليات git | Bash |
| `general-purpose` | مهام عامة متعددة الخطوات | جميع الأدوات |
| `Explore` | استكشاف سريع لقاعدة الكود | جميع الأدوات باستثناء Agent/Edit/Write/NotebookEdit/ExitPlanMode |
| `Plan` | تصميم خطط التنفيذ | جميع الأدوات باستثناء Agent/Edit/Write/NotebookEdit/ExitPlanMode |
| `claude-code-guide` | أسئلة وأجوبة حول دليل استخدام Claude Code | Glob, Grep, Read, WebFetch, WebSearch |
| `statusline-setup` | تكوين شريط الحالة | Read, Edit |

## سيناريوهات الاستخدام

**مناسب للاستخدام:**
- المهام المعقدة التي تتطلب إنجازاً مستقلاً متعدد الخطوات
- استكشاف قاعدة الكود والبحث المعمق (باستخدام نوع Explore)
- العمل المتوازي الذي يتطلب بيئة معزولة
- المهام طويلة المدة التي تحتاج للعمل في الخلفية

**غير مناسب للاستخدام:**
- قراءة مسار ملف محدد — استخدم Read أو Glob مباشرة
- البحث في 2-3 ملفات معروفة — استخدم Read مباشرة
- البحث عن تعريف فئة محددة — استخدم Glob مباشرة

## ملاحظات

- بعد اكتمال الوكيل الفرعي يُرجع رسالة واحدة، نتائجه غير مرئية للمستخدم ويحتاج الوكيل الرئيسي لنقلها
- يمكن إطلاق عدة استدعاءات Agent بالتوازي في رسالة واحدة لزيادة الكفاءة
- يتم فحص تقدم المهام الخلفية عبر أداة TaskOutput
- نوع Explore أبطأ من استدعاء Glob/Grep مباشرة، يُستخدم فقط عندما لا يكفي البحث البسيط
- استخدم `run_in_background: true` للمهام طويلة المدة التي لا تحتاج نتائج فورية؛ استخدم الوضع الأمامي (الافتراضي) عندما تكون النتيجة مطلوبة قبل المتابعة
- يتيح معامل `resume` استئناف جلسة وكيل فرعي بدأت سابقاً مع الحفاظ على السياق المتراكم

## الأهمية في cc-viewer

Agent هو الاسم الجديد لأداة Task في الإصدارات الأخيرة من Claude Code. ينتج استدعاء Agent سلسلة طلبات SubAgent، يمكن رؤية تسلسل طلبات فرعية مستقلة عن MainAgent في قائمة الطلبات. عادة ما تتميز طلبات SubAgent بـ system prompt مختصر وتعريفات أدوات أقل، مما يشكل تبايناً واضحاً مع MainAgent. في cc-viewer، قد يظهر اسم الأداة `Task` أو `Agent` حسب إصدار Claude Code المستخدم في المحادثة المسجلة.
